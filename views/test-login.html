<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <title>ØªØ¬Ø±Ø¨Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <style>
      body {
        font-family: Arial;
        padding: 20px;
        direction: rtl;
      }
      input {
        padding: 10px;
        margin: 5px;
        width: 300px;
        font-size: 16px;
      }
      button {
        padding: 10px 20px;
        font-size: 16px;
        margin-top: 10px;
        cursor: pointer;
      }
      pre {
        background-color: #eee;
        padding: 10px;
        direction: ltr;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Firebase)</h2>

    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label><br />
    <input id="phone" type="text" placeholder="+97059XXXXXXX" /><br />
    <div id="recaptcha-container"></div>
    <button onclick="sendCode()">ğŸ“² Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</button>

    <br /><br />

    <label>Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚:</label><br />
    <input id="code" type="text" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§" /><br />
    <button onclick="verifyCode()">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ†</button>

    <h3>ğŸŸï¸ ID Token:</h3>
    <pre id="token"></pre>

    <script>
      // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyDSlyhvvMOfOM0MFuReHZvNfihEFeNvdIQ",
        authDomain: "mdad-test.firebaseapp.com",
        projectId: "mdad-test",
        storageBucket: "mdad-test.appspot.com",
        messagingSenderId: "839692512492",
        appId: "1:839692512492:web:45296527f939edda0049c9",
        measurementId: "G-JNTJJ0M41L"
      };

      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();

      window.onload = function () {
        window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(
          "recaptcha-container",
          {
            size: "normal",
            callback: function (response) {
              console.log("reCAPTCHA verified");
            },
          }
        );
        recaptchaVerifier.render();
      };

      function sendCode() {
        const phoneNumber = document.getElementById("phone").value;
        const appVerifier = window.recaptchaVerifier;

        auth.signInWithPhoneNumber(phoneNumber, appVerifier)
          .then((confirmationResult) => {
            window.confirmationResult = confirmationResult;
            alert("ğŸ“¨ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯! Ø£Ø¯Ø®Ù„Ù‡ Ø§Ù„Ø¢Ù†.");
          })
          .catch((error) => {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯:", error);
            alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯.");
          });
      }

      function verifyCode() {
        const code = document.getElementById("code").value;

        window.confirmationResult
          .confirm(code)
          .then((result) => {
            return result.user.getIdToken();
          })
          .then((token) => {
            document.getElementById("token").innerText = token;
            alert("ğŸ‰ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„! Ø®Ø° Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø¢Ù†.");
          })
          .catch((error) => {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚:", error);
            alert("âŒ ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ.");
          });
      }
    </script>
  </body>
</html>
